Main Window
===========

The Main Window is the entry point of the BIGSS XReg GUI. From here, you can select the process you wish to perform and set up the working directory.

Overview
--------

.. figure:: images/main_window.png
   :align: center
   :width: 80%

   The Main Window of the BIGSS XReg GUI.

Include a screenshot of the Main Window here.

Components
----------

1. **Working Directory **

   The working directory is where all outputs, configurations, and intermediate files will be stored.

   By default, the working directory should be organized using the following structure:

By default, the working directory should be organized using the following structure:

.. code-block:: text

   working_dir/
   ├── meta_data/
   │   ├── XrayDICOM/
   │   │   ├── 01_1
   │   │   ├── 02_1
   │   │   └── ...
   │
   │   ├── volumes/
   │   │   ├── spine_CT.nii.gz
   │   │   ├── spine_CT_segmentation.nii.gz
   │   │   └── ...
   │
   │   ├── landmarks/
   │   │   ├── landmarks_2d/
   │   │   │   ├── 01_1_spine_landmark_2d.fcsv
   │   │   │   ├── 02_1_spine_landmark_2d.fcsv
   │   │   │   └── ...
   │   │   └── landmarks_3d/
   │   │       └── spine_landmark_3d.fcsv
   │
   │   └── model/
   │       └── spine_model.stl
   ├── logs/
   ├── configs/
   └── outputs/

A brief description of each subdirectory:

- **meta_data/**

Contains all metadata related to the imaging and registration processes.

- **XrayDICOM/**

    -  Stores DICOM files from X-ray images. Each file represents a single X-ray image. The naming convention for CIOS fusion looks like `01_1`, `02_1`, etc (DICOM files without extension)
-
    **volumes/**

    -  Stores volumetric imaging data such as CT or MRI scans and thier corresponding segmentation volumes. The default file format is NIfTI (.nii.gz). For the registration pipeline to work, it is important to ensure that the 3D volume and its corresponding segmentation volume share the exact same volume dimensions and slice spacings. By default the segmentation is a labelmap where each voxel value (in integer) corresponds to a specific anatomical structure, with label=0 representing background.


- **landmarks/**

    - **landmarks_2d/**

    -  Contains 2D landmark files in FCSV format. By default, these landmarks should be annoteted from their corresponding X-ray images in the `XrayDICOM` folder. The naming convention is `<X-ray_ID>_1_<anatomy_name>_landmark_2d.fcsv'

    - **landmarks_3d/**

    -  Contains 3D landmark files in FCSV format. These landmarks should be annotated from the 3D volume data in the `volumes` folder. The naming convention is `<anatomy_name>_landmark_3d.fcsv'
    

- **model/**

    - Holds 3D model files (usually in STL format) for visualization purposes. The files are not required to perform 2D/3D registration.

- **logs/**

    - Contains log files automatically generated during process executions.

- **configs/**

    - Stores configuration files in YAML or JSON format. Each configuration file defines parameters and settings for specific processes, ensuring reproducibility and consistency. These files are generated and loaded by the GUI.

- **outputs/**
    
    The destination directory for all processed data. Contains results such as registration outputs, DRRs, and any other data generated by the processes.

.. **Visual Representation:**

.. .. figure:: images/working_directory_structure.png
..    :align: center
..    :width: 80%

..    *The working directory structure used by BIGSS XReg GUI.*

.. *Include a screenshot or diagram of the working directory structure here to provide a visual understanding.*


3. **Process Selection**

   Currently available processes Include:

   - **Create projection files from X-ray images**
   - **Single-target singleview registration**
   - **Single-target multiview registration**
   - **Create DRR**


Process Descriptions
--------------------

- **Create projection files from X-ray images**

  Converts X-ray DICOM images into projection data files with optional landmark inclusion.

- **Single-target singleview registration**

  Performs image registration using a single target and a single view.

- **Single-target multiview registration**

  Extends single-target registration to multiple views for enhanced accuracy.

- **Create DRR**

  Generates Digital Reconstructed Radiographs from 3D volume data.


Notes
-----

- Ensure that the working directory has appropriate read/write permissions and follows the recommended structure.

